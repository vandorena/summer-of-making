// @tiptap/extension-code-block@2.12.0 downloaded from https://ga.jspm.io/npm:@tiptap/extension-code-block@2.12.0/dist/index.js

import{Node as t,textblockTypeInputRule as e,mergeAttributes as n}from"@tiptap/core";import{Plugin as r,TextSelection as a,PluginKey as s,Selection as o}from"@tiptap/pm/state";const i=/^```([a-z]+)?[\s\n]$/;const l=/^~~~([a-z]+)?[\s\n]$/;const c=t.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:true,exitOnArrowDown:true,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:true,defining:true,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options;const r=[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]];const a=r.filter((t=>t.startsWith(n))).map((t=>t.replace(n,"")));const s=a[0];return s||null},rendered:false}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",n(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection;const n=e.pos===1;return!(!t||e.parent.type.name!==this.name)&&(!(!n&&e.parent.textContent.length)&&this.editor.commands.clearNodes())},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return false;const{state:e}=t;const{selection:n}=e;const{$from:r,empty:a}=n;if(!a||r.parent.type!==this.type)return false;const s=r.parentOffset===r.parent.nodeSize-2;const o=r.parent.textContent.endsWith("\n\n");return!(!s||!o)&&t.chain().command((({tr:t})=>{t.delete(r.pos-2,r.pos);return true})).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return false;const{state:e}=t;const{selection:n,doc:r}=e;const{$from:a,empty:s}=n;if(!s||a.parent.type!==this.type)return false;const i=a.parentOffset===a.parent.nodeSize-2;if(!i)return false;const l=a.after();if(l===void 0)return false;const c=r.nodeAt(l);return c?t.commands.command((({tr:t})=>{t.setSelection(o.near(r.resolve(l)));return true})):t.commands.exitCode()}}},addInputRules(){return[e({find:i,type:this.type,getAttributes:t=>({language:t[1]})}),e({find:l,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new r({key:new s("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData)return false;if(this.editor.isActive(this.type.name))return false;const n=e.clipboardData.getData("text/plain");const r=e.clipboardData.getData("vscode-editor-data");const s=r?JSON.parse(r):void 0;const o=s===null||s===void 0?void 0:s.mode;if(!n||!o)return false;const{tr:i,schema:l}=t.state;const c=l.text(n.replace(/\r\n?/g,"\n"));i.replaceSelectionWith(this.type.create({language:o},c));i.selection.$from.parent.type!==this.type&&i.setSelection(a.near(i.doc.resolve(Math.max(0,i.selection.from-2))));i.setMeta("paste",true);t.dispatch(i);return true}}})]}});export{c as CodeBlock,i as backtickInputRegex,c as default,l as tildeInputRegex};

